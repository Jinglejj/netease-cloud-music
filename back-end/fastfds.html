<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Centos下搭建Fastdfs | My Blog</title>
    <meta name="description" content="Just playing around">
    
    
    <link rel="preload" href="/blog/assets/css/0.styles.2b478e90.css" as="style"><link rel="preload" href="/blog/assets/js/app.4cf69cb3.js" as="script"><link rel="preload" href="/blog/assets/js/5.feafeb0c.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.58982081.js"><link rel="prefetch" href="/blog/assets/js/11.5bcfe1b7.js"><link rel="prefetch" href="/blog/assets/js/2.a33be84c.js"><link rel="prefetch" href="/blog/assets/js/3.98ec0fe7.js"><link rel="prefetch" href="/blog/assets/js/4.df1b979b.js"><link rel="prefetch" href="/blog/assets/js/6.cde8d8ab.js"><link rel="prefetch" href="/blog/assets/js/7.ef73961a.js"><link rel="prefetch" href="/blog/assets/js/8.88b71ced.js"><link rel="prefetch" href="/blog/assets/js/9.70f81dfd.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.2b478e90.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">My Blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/back-end/" class="nav-link router-link-active">后端</a></div><div class="nav-item"><a href="/blog/front-end/" class="nav-link">前端</a></div><div class="nav-item"><a href="/blog/collection/" class="nav-link">收藏</a></div><div class="nav-item"><a href="/blog/project/" class="nav-link">项目</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/back-end/" class="nav-link router-link-active">后端</a></div><div class="nav-item"><a href="/blog/front-end/" class="nav-link">前端</a></div><div class="nav-item"><a href="/blog/collection/" class="nav-link">收藏</a></div><div class="nav-item"><a href="/blog/project/" class="nav-link">项目</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/back-end/" class="sidebar-link">文章收集</a></li><li><a href="/blog/back-end/fastfds.html" class="active sidebar-link">Centos下搭建Fastdfs</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/back-end/fastfds.html#使用的系统软件" class="sidebar-link">使用的系统软件</a></li><li class="sidebar-sub-header"><a href="/blog/back-end/fastfds.html#编译环境" class="sidebar-link">编译环境</a></li><li class="sidebar-sub-header"><a href="/blog/back-end/fastfds.html#磁盘目录" class="sidebar-link">磁盘目录</a></li><li class="sidebar-sub-header"><a href="/blog/back-end/fastfds.html#安装-libfatscommon" class="sidebar-link">安装 libfatscommon</a></li><li class="sidebar-sub-header"><a href="/blog/back-end/fastfds.html#安装-fastdfs" class="sidebar-link">安装 FastDFS</a></li><li class="sidebar-sub-header"><a href="/blog/back-end/fastfds.html#配置文件准备" class="sidebar-link">配置文件准备</a></li><li class="sidebar-sub-header"><a href="/blog/back-end/fastfds.html#安装-fastdfs-nginx-module" class="sidebar-link">安装 fastdfs-nginx-module</a></li><li class="sidebar-sub-header"><a href="/blog/back-end/fastfds.html#安装-nginx" class="sidebar-link">安装 nginx</a></li><li class="sidebar-sub-header"><a href="/blog/back-end/fastfds.html#tracker-配置" class="sidebar-link">tracker 配置</a></li><li class="sidebar-sub-header"><a href="/blog/back-end/fastfds.html#storage-配置" class="sidebar-link">storage 配置</a></li><li class="sidebar-sub-header"><a href="/blog/back-end/fastfds.html#client-测试" class="sidebar-link">client 测试</a></li><li class="sidebar-sub-header"><a href="/blog/back-end/fastfds.html#配置-nginx-访问" class="sidebar-link">配置 nginx 访问</a></li><li class="sidebar-sub-header"><a href="/blog/back-end/fastfds.html#tracker-配置-2" class="sidebar-link">tracker 配置</a></li><li class="sidebar-sub-header"><a href="/blog/back-end/fastfds.html#storage-配置-2" class="sidebar-link">storage 配置</a></li><li class="sidebar-sub-header"><a href="/blog/back-end/fastfds.html#client-测试-2" class="sidebar-link">client 测试</a></li><li class="sidebar-sub-header"><a href="/blog/back-end/fastfds.html#配置-nginx-访问-2" class="sidebar-link">配置 nginx 访问</a></li><li class="sidebar-sub-header"><a href="/blog/back-end/fastfds.html#防火墙" class="sidebar-link">防火墙</a></li><li class="sidebar-sub-header"><a href="/blog/back-end/fastfds.html#tracker" class="sidebar-link">tracker</a></li><li class="sidebar-sub-header"><a href="/blog/back-end/fastfds.html#nginx" class="sidebar-link">nginx</a></li><li class="sidebar-sub-header"><a href="/blog/back-end/fastfds.html#检测集群" class="sidebar-link">检测集群</a></li><li class="sidebar-sub-header"><a href="/blog/back-end/fastfds.html#配置文件" class="sidebar-link">配置文件</a></li><li class="sidebar-sub-header"><a href="/blog/back-end/fastfds.html#可能遇到的问题" class="sidebar-link">可能遇到的问题</a></li></ul></li></ul> </div> <div class="page"> <div class="content"><h1 id="centos下搭建fastdfs"><a href="#centos下搭建fastdfs" aria-hidden="true" class="header-anchor">#</a> Centos下搭建Fastdfs</h1> <h1 id="环境准备"><a href="#环境准备" aria-hidden="true" class="header-anchor">#</a> 环境准备</h1> <h2 id="使用的系统软件"><a href="#使用的系统软件" aria-hidden="true" class="header-anchor">#</a> <a href="#%E4%BD%BF%E7%94%A8%E7%9A%84%E7%B3%BB%E7%BB%9F%E8%BD%AF%E4%BB%B6"></a>使用的系统软件</h2> <table><thead><tr><th style="text-align:left">名称</th> <th>说明</th></tr></thead> <tbody><tr><td style="text-align:left">centos</td> <td>7.x</td></tr> <tr><td style="text-align:left">libfatscommon</td> <td>FastDFS 分离出的一些公用函数包</td></tr> <tr><td style="text-align:left">FastDFS</td> <td>FastDFS 本体</td></tr> <tr><td style="text-align:left">fastdfs-nginx-module</td> <td>FastDFS 和 nginx 的关联模块</td></tr> <tr><td style="text-align:left">nginx</td> <td>nginx1.15.4</td></tr></tbody></table> <h2 id="编译环境"><a href="#编译环境" aria-hidden="true" class="header-anchor">#</a> <a href="#%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83"></a>编译环境</h2> <div class="language-shell extra-class"><pre class="language-text"><code>yum install git gcc gcc-c++ make automake autoconf libtool pcre pcre-devel zlib zlib-devel openssl-devel wget vim -y
</code></pre></div><h2 id="磁盘目录"><a href="#磁盘目录" aria-hidden="true" class="header-anchor">#</a> <a href="#%E7%A3%81%E7%9B%98%E7%9B%AE%E5%BD%95"></a>磁盘目录</h2> <table><thead><tr><th>说明</th> <th>位置</th></tr></thead> <tbody><tr><td>所有安装包</td> <td>/usr/local/src</td></tr> <tr><td>数据存储位置</td> <td>/home/dfs/</td></tr></tbody></table> <div class="language-shell extra-class"><pre class="language-text"><code>mkdir /home/dfs #创建数据存储目录
cd /usr/local/src #切换到安装目录准备下载安装包
</code></pre></div><h2 id="安装-libfatscommon"><a href="#安装-libfatscommon" aria-hidden="true" class="header-anchor">#</a> <a href="#%E5%AE%89%E8%A3%85libfatscommon"></a>安装 libfatscommon</h2> <div class="language-shell extra-class"><pre class="language-text"><code>git clone https://github.com/happyfish100/libfastcommon.git --depth 1
cd libfastcommon/
./make.sh &amp;&amp; ./make.sh install #编译安装
</code></pre></div><h2 id="安装-fastdfs"><a href="#安装-fastdfs" aria-hidden="true" class="header-anchor">#</a> <a href="#%E5%AE%89%E8%A3%85fastdfs"></a>安装 FastDFS</h2> <div class="language-shell extra-class"><pre class="language-text"><code>cd ../ #返回上一级目录
git clone https://github.com/happyfish100/fastdfs.git --depth 1
cd fastdfs/
./make.sh &amp;&amp; ./make.sh install #编译安装
</code></pre></div><hr> <h2 id="配置文件准备"><a href="#配置文件准备" aria-hidden="true" class="header-anchor">#</a> 配置文件准备</h2> <div class="language-shell extra-class"><pre class="language-text"><code>cp /etc/fdfs/tracker.conf.sample /etc/fdfs/tracker.conf
cp /etc/fdfs/storage.conf.sample /etc/fdfs/storage.conf
cp /etc/fdfs/client.conf.sample /etc/fdfs/client.conf #客户端文件，测试用
cp /usr/local/src/fastdfs/conf/http.conf /etc/fdfs/ #供nginx访问使用
cp /usr/local/src/fastdfs/conf/mime.types /etc/fdfs/ #供nginx访问使用
</code></pre></div><h2 id="安装-fastdfs-nginx-module"><a href="#安装-fastdfs-nginx-module" aria-hidden="true" class="header-anchor">#</a> <a href="#%E5%AE%89%E8%A3%85fastdfs-nginx-module"></a>安装 fastdfs-nginx-module</h2> <div class="language-shell extra-class"><pre class="language-text"><code>cd ../ #返回上一级目录
git clone https://github.com/happyfish100/fastdfs-nginx-module.git --depth 1
cp /usr/local/src/fastdfs-nginx-module/src/mod_fastdfs.conf /etc/fdfs
</code></pre></div><h2 id="安装-nginx"><a href="#安装-nginx" aria-hidden="true" class="header-anchor">#</a> <a href="#%E5%AE%89%E8%A3%85nginx"></a>安装 nginx</h2> <div class="language-shell extra-class"><pre class="language-text"><code>wget http://nginx.org/download/nginx-1.15.4.tar.gz #下载nginx压缩包
tar -zxvf nginx-1.15.4.tar.gz #解压
cd nginx-1.15.4/
#添加fastdfs-nginx-module模块
./configure --add-module=/usr/local/src/fastdfs-nginx-module/src/ 
make &amp;&amp; make install #编译安装
</code></pre></div><h1 id="单机部署"><a href="#单机部署" aria-hidden="true" class="header-anchor">#</a> <a href="#%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2"></a>单机部署</h1> <h2 id="tracker-配置"><a href="#tracker-配置" aria-hidden="true" class="header-anchor">#</a> <a href="#tracker%E9%85%8D%E7%BD%AE"></a>tracker 配置</h2> <div class="language-vim extra-class"><pre class="language-vim"><code>#服务器ip为 <span class="token number">192.168</span><span class="token operator">.</span><span class="token number">52.1</span>
#建议用ftp下载下来这些文件 本地修改
<span class="token keyword">vim</span> <span class="token operator">/</span>etc<span class="token operator">/</span>fdfs<span class="token operator">/</span>tracker<span class="token operator">.</span><span class="token keyword">conf</span>
#需要修改的内容如下
port<span class="token operator">=</span><span class="token number">22122</span>  # tracker服务器端口（默认<span class="token number">22122</span><span class="token punctuation">,</span>一般不修改）
base_path<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>dfs  # 存储日志和数据的根目录
</code></pre></div><h2 id="storage-配置"><a href="#storage-配置" aria-hidden="true" class="header-anchor">#</a> <a href="#storage%E9%85%8D%E7%BD%AE"></a>storage 配置</h2> <div class="language-vim extra-class"><pre class="language-vim"><code><span class="token keyword">vim</span> <span class="token operator">/</span>etc<span class="token operator">/</span>fdfs<span class="token operator">/</span>storage<span class="token operator">.</span><span class="token keyword">conf</span>
#需要修改的内容如下
port<span class="token operator">=</span><span class="token number">23000</span>  # storage服务端口（默认<span class="token number">23000</span><span class="token punctuation">,</span>一般不修改）
base_path<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>dfs  # 数据和日志文件存储根目录
store_path0<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>dfs  # 第一个存储目录
tracker_server<span class="token operator">=</span><span class="token number">192.168</span><span class="token operator">.</span><span class="token number">52.1</span><span class="token punctuation">:</span><span class="token number">22122</span>  # tracker服务器IP和端口
http<span class="token operator">.</span>server_port<span class="token operator">=</span><span class="token number">8888</span>  # http访问文件的端口<span class="token punctuation">(</span>默认<span class="token number">8888</span><span class="token punctuation">,</span>看情况修改<span class="token punctuation">,</span>和nginx中保持一致<span class="token punctuation">)</span>
</code></pre></div><h2 id="client-测试"><a href="#client-测试" aria-hidden="true" class="header-anchor">#</a> <a href="#client%E6%B5%8B%E8%AF%95"></a>client 测试</h2> <div class="language-vim extra-class"><pre class="language-vim"><code><span class="token keyword">vim</span> <span class="token operator">/</span>etc<span class="token operator">/</span>fdfs<span class="token operator">/</span>client<span class="token operator">.</span><span class="token keyword">conf</span>
#需要修改的内容如下
base_path<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>dfs
tracker_server<span class="token operator">=</span><span class="token number">192.168</span><span class="token operator">.</span><span class="token number">52.1</span><span class="token punctuation">:</span><span class="token number">22122</span>    #tracker服务器IP和端口
#保存后测试<span class="token punctuation">,</span>返回ID表示成功 如：group1<span class="token operator">/</span>M00<span class="token operator">/</span><span class="token number">00</span><span class="token operator">/</span><span class="token number">00</span><span class="token operator">/</span>xx<span class="token operator">.</span>tar<span class="token operator">.</span>gz
fdfs_upload_file <span class="token operator">/</span>etc<span class="token operator">/</span>fdfs<span class="token operator">/</span>client<span class="token operator">.</span><span class="token keyword">conf</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>src<span class="token operator">/</span>nginx<span class="token operator">-</span><span class="token number">1.15</span><span class="token operator">.</span><span class="token number">4</span><span class="token operator">.</span>tar<span class="token operator">.</span>gz
</code></pre></div><div class="danger custom-block"><p class="custom-block-title">WARNING</p> <p>要启动tracker服务和storage服务后才能测试</p></div> <h2 id="配置-nginx-访问"><a href="#配置-nginx-访问" aria-hidden="true" class="header-anchor">#</a> <a href="#%E9%85%8D%E7%BD%AEnginx%E8%AE%BF%E9%97%AE"></a>配置 nginx 访问</h2> <div class="language-vim extra-class"><pre class="language-vim"><code><span class="token keyword">vim</span> <span class="token operator">/</span>etc<span class="token operator">/</span>fdfs<span class="token operator">/</span>mod_fastdfs<span class="token operator">.</span><span class="token keyword">conf</span>
#需要修改的内容如下
tracker_server<span class="token operator">=</span><span class="token number">192.168</span><span class="token operator">.</span><span class="token number">52.1</span><span class="token punctuation">:</span><span class="token number">22122</span>  #tracker服务器IP和端口
url_have_group_name<span class="token operator">=</span>true
store_path0<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>dfs
</code></pre></div><div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token comment">#配置nginx.config</span>
vim <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token operator">/</span>nginx<span class="token punctuation">.</span>conf
<span class="token comment">#添加如下配置</span>
<span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token keyword">listen</span>       <span class="token number">8888</span><span class="token punctuation">;</span>    <span class="token comment">## 该端口为storage.conf中的http.server_port相同</span>
    <span class="token keyword">server_name</span>  localhost<span class="token punctuation">;</span>
    <span class="token keyword">location</span> <span class="token operator">~</span><span class="token operator">/</span>group<span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token operator">/</span> <span class="token punctuation">{</span>
        ngx_fastdfs_module<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">error_page</span>   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  <span class="token operator">/</span><span class="token number">50</span>x<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
    <span class="token keyword">location</span> <span class="token operator">=</span> <span class="token operator">/</span><span class="token number">50</span>x<span class="token punctuation">.</span>html <span class="token punctuation">{</span>
    <span class="token keyword">root</span>   html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">#测试下载，用外部浏览器访问刚才已传过的nginx安装包,引用返回的ID</span>
http://192.168.52.1:8888/group1/M00/00/00/wKgAQ1pysxmAaqhAAA76tz-dVgg.tar.gz
<span class="token comment">#弹出下载单机部署全部跑通</span>
</code></pre></div><h1 id="分布式部署"><a href="#分布式部署" aria-hidden="true" class="header-anchor">#</a> <a href="#%E5%88%86%E5%B8%83%E5%BC%8F%E9%83%A8%E7%BD%B2"></a>分布式部署</h1> <h2 id="tracker-配置-2"><a href="#tracker-配置-2" aria-hidden="true" class="header-anchor">#</a> <a href="#tracker%E9%85%8D%E7%BD%AE-1"></a>tracker 配置</h2> <div class="language-vim extra-class"><pre class="language-vim"><code>#服务器ip为 <span class="token number">192.168</span><span class="token operator">.</span><span class="token number">52.2</span><span class="token punctuation">,</span><span class="token number">192.168</span><span class="token operator">.</span><span class="token number">52.3</span><span class="token punctuation">,</span><span class="token number">192.168</span><span class="token operator">.</span><span class="token number">52.4</span>
#我建议用ftp下载下来这些文件 本地修改
<span class="token keyword">vim</span> <span class="token operator">/</span>etc<span class="token operator">/</span>fdfs<span class="token operator">/</span>tracker<span class="token operator">.</span><span class="token keyword">conf</span>
#需要修改的内容如下
port<span class="token operator">=</span><span class="token number">22122</span>  # tracker服务器端口（默认<span class="token number">22122</span><span class="token punctuation">,</span>一般不修改）
base_path<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>dfs  # 存储日志和数据的根目录
</code></pre></div><h2 id="storage-配置-2"><a href="#storage-配置-2" aria-hidden="true" class="header-anchor">#</a> <a href="#storage%E9%85%8D%E7%BD%AE-1"></a>storage 配置</h2> <div class="language-vim extra-class"><pre class="language-vim"><code><span class="token keyword">vim</span> <span class="token operator">/</span>etc<span class="token operator">/</span>fdfs<span class="token operator">/</span>storage<span class="token operator">.</span><span class="token keyword">conf</span>
#需要修改的内容如下
port<span class="token operator">=</span><span class="token number">23000</span>  # storage服务端口（默认<span class="token number">23000</span><span class="token punctuation">,</span>一般不修改）
base_path<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>dfs  # 数据和日志文件存储根目录
store_path0<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>dfs  # 第一个存储目录
tracker_server<span class="token operator">=</span><span class="token number">192.168</span><span class="token operator">.</span><span class="token number">52.2</span><span class="token punctuation">:</span><span class="token number">22122</span>  # 服务器<span class="token number">1</span>
tracker_server<span class="token operator">=</span><span class="token number">192.168</span><span class="token operator">.</span><span class="token number">52.3</span><span class="token punctuation">:</span><span class="token number">22122</span>  # 服务器<span class="token number">2</span>
tracker_server<span class="token operator">=</span><span class="token number">192.168</span><span class="token operator">.</span><span class="token number">52.4</span><span class="token punctuation">:</span><span class="token number">22122</span>  # 服务器<span class="token number">3</span>
http<span class="token operator">.</span>server_port<span class="token operator">=</span><span class="token number">8888</span>  # http访问文件的端口<span class="token punctuation">(</span>默认<span class="token number">8888</span><span class="token punctuation">,</span>看情况修改<span class="token punctuation">,</span>和nginx中保持一致<span class="token punctuation">)</span>
</code></pre></div><h2 id="client-测试-2"><a href="#client-测试-2" aria-hidden="true" class="header-anchor">#</a> <a href="#client%E6%B5%8B%E8%AF%95-1"></a>client 测试</h2> <div class="language-vim extra-class"><pre class="language-vim"><code><span class="token keyword">vim</span> <span class="token operator">/</span>etc<span class="token operator">/</span>fdfs<span class="token operator">/</span>client<span class="token operator">.</span><span class="token keyword">conf</span>
#需要修改的内容如下
base_path<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>moe<span class="token operator">/</span>dfs
tracker_server<span class="token operator">=</span><span class="token number">192.168</span><span class="token operator">.</span><span class="token number">52.2</span><span class="token punctuation">:</span><span class="token number">22122</span>  # 服务器<span class="token number">1</span>
tracker_server<span class="token operator">=</span><span class="token number">192.168</span><span class="token operator">.</span><span class="token number">52.3</span><span class="token punctuation">:</span><span class="token number">22122</span>  # 服务器<span class="token number">2</span>
tracker_server<span class="token operator">=</span><span class="token number">192.168</span><span class="token operator">.</span><span class="token number">52.4</span><span class="token punctuation">:</span><span class="token number">22122</span>  # 服务器<span class="token number">3</span>
#保存后测试<span class="token punctuation">,</span>返回ID表示成功 如：group1<span class="token operator">/</span>M00<span class="token operator">/</span><span class="token number">00</span><span class="token operator">/</span><span class="token number">00</span><span class="token operator">/</span>xx<span class="token operator">.</span>tar<span class="token operator">.</span>gz
fdfs_upload_file <span class="token operator">/</span>etc<span class="token operator">/</span>fdfs<span class="token operator">/</span>client<span class="token operator">.</span><span class="token keyword">conf</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>src<span class="token operator">/</span>nginx<span class="token operator">-</span><span class="token number">1.15</span><span class="token operator">.</span><span class="token number">4</span><span class="token operator">.</span>tar<span class="token operator">.</span>gz
</code></pre></div><h2 id="配置-nginx-访问-2"><a href="#配置-nginx-访问-2" aria-hidden="true" class="header-anchor">#</a> <a href="#%E9%85%8D%E7%BD%AEnginx%E8%AE%BF%E9%97%AE-1"></a>配置 nginx 访问</h2> <div class="language-vim extra-class"><pre class="language-vim"><code><span class="token keyword">vim</span> <span class="token operator">/</span>etc<span class="token operator">/</span>fdfs<span class="token operator">/</span>mod_fastdfs<span class="token operator">.</span><span class="token keyword">conf</span>
#需要修改的内容如下
tracker_server<span class="token operator">=</span><span class="token number">192.168</span><span class="token operator">.</span><span class="token number">52.2</span><span class="token punctuation">:</span><span class="token number">22122</span>  # 服务器<span class="token number">1</span>
tracker_server<span class="token operator">=</span><span class="token number">192.168</span><span class="token operator">.</span><span class="token number">52.3</span><span class="token punctuation">:</span><span class="token number">22122</span>  # 服务器<span class="token number">2</span>
tracker_server<span class="token operator">=</span><span class="token number">192.168</span><span class="token operator">.</span><span class="token number">52.4</span><span class="token punctuation">:</span><span class="token number">22122</span>  # 服务器<span class="token number">3</span>
url_have_group_name<span class="token operator">=</span>true
store_path0<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>dfs
</code></pre></div><div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token comment">#配置nginx.config</span>
vim <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token operator">/</span>nginx<span class="token punctuation">.</span>conf
<span class="token comment">#添加如下配置</span>
<span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token keyword">listen</span>       <span class="token number">8888</span><span class="token punctuation">;</span>    <span class="token comment">## 该端口为storage.conf中的http.server_port相同</span>
    <span class="token keyword">server_name</span>  localhost<span class="token punctuation">;</span>
    <span class="token keyword">location</span> <span class="token operator">~</span><span class="token operator">/</span>group<span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token operator">/</span> <span class="token punctuation">{</span>
        ngx_fastdfs_module<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">error_page</span>   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  <span class="token operator">/</span><span class="token number">50</span>x<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
    <span class="token keyword">location</span> <span class="token operator">=</span> <span class="token operator">/</span><span class="token number">50</span>x<span class="token punctuation">.</span>html <span class="token punctuation">{</span>
    <span class="token keyword">root</span>   html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h1 id="启动"><a href="#启动" aria-hidden="true" class="header-anchor">#</a> <a href="#%E5%90%AF%E5%8A%A8"></a>启动</h1> <h2 id="防火墙"><a href="#防火墙" aria-hidden="true" class="header-anchor">#</a> <a href="#%E9%98%B2%E7%81%AB%E5%A2%99"></a>防火墙</h2> <p>#不关闭防火墙的话无法使用
systemctl stop firewalld.service #关闭
systemctl restart firewalld.service #重启</p> <h2 id="tracker"><a href="#tracker" aria-hidden="true" class="header-anchor">#</a> <a href="#tracker"></a>tracker</h2> <p>``shell
/etc/init.d/fdfs_trackerd start #启动tracker服务
/etc/init.d/fdfs_trackerd restart #重启动tracker服务
/etc/init.d/fdfs_trackerd stop #停止tracker服务
chkconfig fdfs_trackerd on #自启动tracker服务</p> <div class="language- extra-class"><pre class="language-text"><code>
## [](#storage)storage

```shell
/etc/init.d/fdfs_storaged start #启动storage服务
/etc/init.d/fdfs_storaged restart #重动storage服务
/etc/init.d/fdfs_storaged stop #停止动storage服务
chkconfig fdfs_storaged on #自启动storage服务
</code></pre></div><h2 id="nginx"><a href="#nginx" aria-hidden="true" class="header-anchor">#</a> <a href="#nginx"></a>nginx</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>/usr/local/nginx/sbin/nginx <span class="token comment">#启动nginx</span>
/usr/local/nginx/sbin/nginx -s reload <span class="token comment">#重启nginx</span>
/usr/local/nginx/sbin/nginx -s stop <span class="token comment">#停止nginx</span>
</code></pre></div><h2 id="检测集群"><a href="#检测集群" aria-hidden="true" class="header-anchor">#</a> <a href="#%E6%A3%80%E6%B5%8B%E9%9B%86%E7%BE%A4"></a>检测集群</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>/usr/bin/fdfs_monitor /etc/fdfs/storage.conf
<span class="token comment"># 会显示会有几台服务器 有3台就会 显示 Storage 1-Storage 3的详细信息</span>
</code></pre></div><h1 id="说明"><a href="#说明" aria-hidden="true" class="header-anchor">#</a> <a href="#%E8%AF%B4%E6%98%8E"></a>说明</h1> <h2 id="配置文件"><a href="#配置文件" aria-hidden="true" class="header-anchor">#</a> <a href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"></a>配置文件</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>tracker_server <span class="token comment">#有几台服务器写几个</span>
group_name <span class="token comment">#地址的名称的命名</span>
bind_addr <span class="token comment">#服务器ip绑定</span>
store_path_count <span class="token comment">#store_path(数字)有几个写几个</span>
store_path<span class="token punctuation">(</span>数字<span class="token punctuation">)</span> <span class="token comment">#设置几个储存地址写几个 从0开</span>
</code></pre></div><h2 id="可能遇到的问题"><a href="#可能遇到的问题" aria-hidden="true" class="header-anchor">#</a> <a href="#%E5%8F%AF%E8%83%BD%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98"></a>可能遇到的问题</h2> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <ol><li>如果不是root 用户 你必须在除了cd的命令之外 全部加sudo</li> <li>如果不是root 用户 编译和安装分开进行 先编译再安装</li> <li>如果上传成功 但是nginx报错404 先检查mod_fastdfs.conf文件中的store_path0是否一致</li> <li>如果nginx无法访问 先检查防火墙 和 mod_fastdfs.conf文件tracker_server是否一致</li> <li>如果不是在/usr/local/src文件夹下安装 可能会编译出错</li></ol></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/back-end/" class="prev router-link-active">
          文章收集
        </a></span> <!----></p></div> </div> <!----></div></div>
    <script src="/blog/assets/js/app.4cf69cb3.js" defer></script><script src="/blog/assets/js/5.feafeb0c.js" defer></script>
  </body>
</html>
